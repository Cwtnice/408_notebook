参考资料：《23王道计算机网络》

<hr>

# 第一章 计算机网络体系结构

## 1.1 计算机网络概述

### 重点

### 1.1.1 计算机网络概念

**计算机网络** ： 能够以相互共享资源的方式互联起来的自治计算机系统的集合

- `目的` ： 资源共享
- `组成单元` ： 多台多里的自治计算机
- `规则` ： 网络协议



<br>



### 1.1.2 计算机网络组成

按 **组成成分** 可以分为：

- `硬件` ：主机、通信链路、通行处理机（网卡）等
- `软件` ： 网络操作系统、FTP程序等
- `协议`

按 **工作方式** 可以分为：

- 边缘部分 ：用户用的主机
- 核心部分 ：大量网络和路由器

按 **功能组成** 可以分成：

- `通信子网` ： 传输介质、通信设备、网络协议
- `资源子网` ： 实现资源共享功能的软硬件集合



<br>



### 1.1.3 计算机网络功能

主要有五大功能：

1. 数据通信
2. 资源共享
3. 分布式处理
4. 提高可靠性
5. 负载均衡



<br>



### 1.1.4 计算机网络分类

按 **分布范围** 可分为：

- 广域网WAN ： 也叫远程网，长距离通信，使用 **交换技术**
- 城域网MAN ： 覆盖一个城市，采用 **以太网技术** ，有时也在局域网的范围
- `局域网LAN` ： 使用 **广播技术**
- 个人区域网PAN ： 一个人的设备，也叫无线个人区域网WPAN



<br>



按 **传输技术** 可分为：

- `广播式网络` ：局域网，广域网中的无线、卫星通信网络
- `点对点网络` ：广域网

区分广播和点对点 ：是否采用 **分组存储转发** 和 **路由选择机制**



<br>



按 **拓扑结构** 可分为：

- 网状 

- 总线形 

- `星形` ： 通信必须经过中央设备（路由器或交换机）

- 环形 ： 令牌环局域网，环中信号单向

网状一般是广域网，其他是局域网



<br>



按 **交换技术** 可分为：

- **电路交换网络** 
    - 传统电话网路
    - 优 ： 直接传送，时延小
    - 缺 ： 线路利用率低、不能差错控制
- **报文交换网路**
    - 也叫 `存储-转发网络`
    - 优 ： 充分利用线路，可以实现格式转换、差错控制
    - 缺 ： 增加了缓冲时延，缓冲区难以管理
- **分组交换网络**
    - 也叫 `包交换网络` ，现在的主流
    - 优 ： 缓冲便于管理、包的平均时延小，更标准化
    - 缺 ： 附加信息开销大



<br>



### 1.1.6 计算机网络的性能指标

#### 带宽Bandwidth

网络的通信线路所能传送数据的能力，比特/秒（b/s）



<br>



#### 时延Delay

指数据（报文或分组）从链路的一段到另一端所需的总时间，总时延包括四部分：

- **发送时延（传输时延）**

    将分组的所有比特 传输到链路 所需的时间（发送分组的第一个比特到最后一个比特发送完毕）

    ```
    发送时延 = 分组长度 / 信道宽度
    ```

    

- **传播时延**

    一个比特从链路的一端到另一端所需的时间

    ```
    传播时延 = 信道长度 / 电磁波在信道上的传播速率
    ```

    

- **处理时延**

    数据在 交换结点 中处理存储转发的准备时间

    比如拆分组的首部、从分组中提取数据部分、差错检验、查找合适的路由等

- **排队时延**

    分组以进入路由器后排队等待转发的过程

注意 ： 

- `处理时延` 和 `排队时延` 一般可忽略不计
- 高速链路提高的是 `数据发送速率` 而非比特在链路上的传播速率，因此只能 `减少数据的发送时延`



<br>



#### 时延带宽积

发送端发送第一个比特即将到达终点时，发送端已经发出了多少比例

也称 **以比特为单位的链路长度**

```
时延带宽积 = 传播时延 * 信道带宽

将链路想象成一根圆柱
长度就是传播时延
横截面就是链路带宽
圆柱的体积就是时延带宽积，也就是能容纳的比特的数量
```



<br>



#### 往返时延RTT

指从发送端发送一个短分组，到发送端接收接收端的确认（假设接收后立马发送确认）总共经历的时间



<br>



#### 吞吐量Throughput

单位时间内通过某个网络的数据量



<br>



#### 速率Speed

连接到计算机网络的主机在数字信道上传输数据的速率

也称为 **数据传输率** 、 **数据率** 、 **比特率**

kb/s	Mb/s	Gb/s

最高数据传输率也称为 **带宽**



<br>



#### 信道利用率

指有百分之多少的时间是有数据通过的

```
信道利用率 = 有数据通过时间 / (有+无)数据通过时间
```



<br>



### 1.1.7 习题

#### 选择题

1. 计算机网络最基本的功能室 `数据通信`

2. 广播式网络不需要服务结点 `错误`

    ```
    广播式网络共享广播信道（如总线），通常是局域网（工作在数据链路层）中的一种通信方式，因此不需要网络层，也不存在路由选择问题
    但必须使用物理层的服务，必须要通过服务访问点实现
    ```

    

3. 世界上最早出现的计算机网络是 `ARPnet`



<br>



## 1.2 计算机网络体系结构与参考模型

### 1.2.1 计算机网络分层结构

网络的体系结构 ： 计网各层及协议的集合

体系结构是抽象的，实现是具体的

在分层结构中，第n层中的活动元素称为 `第n层实体` ，实体指任何可发送或接受信息的硬件或软件进程

不同机器同一层称为 `对等层` ，同一层的实体称为 `对等实体`

**协议数据单元PDU：**

- 对等层之前传送的数据单位称为该层的PDU，第n层为 n-PDU
- PDU的通称 ：物理层-比特、数据链路层-帧、网络层-分组、传输层-报文段

每层中，报文（也就是PDU）分为：

- `服务数据单元SDU` ： 读n层的服务数据单元记为 n-SDU，数据部分
- `协议控制信息PCI` ：第n层的协议控制信息记为 n-PCI，控制信息部分

```
n-SDU + n-PCI = n-PDU = (n-1)-SDU
第n层的报文PDU作为下一层的数据部分SDU
依次往下传
最后到物理层就是一个层层嵌套的PDU，再进行传送，接收方再层层接触嵌套
```

补充：

- 只能通过接口使用下一层的服务，且细节是透明的
- 两台主机通信事，对等层在逻辑上有一条直接信道，表现为不经过下层就能传送信息



<br>



### 1.2.2 协议、接口、服务

#### 网络协议Network Protocol 

是对等实体之间的协议，包括：

- 语法 ：规定了传输数据的格式
- 语义 ：规定了要完成的功能、控制信息等
- 同步 ：规定了顺序



<br>



#### 接口

同一结点相邻两层的实体通过 **服务访问点SAP（逻辑上的）** 进行交互

服务通过SAP提供给上层使用，第n层的SAP就是n+1层访问n层服务的地方 



<br>



#### 服务

服务是垂直的，下层为上层提供的功能调用

服务原语 ： 上层使用下层的服务时必须与下层交换的命令

OSI模型中的服务原语：

- 请求request
- 响应response
- 指示indication
- 证实confirmation

有应答服务包括4种，无应答服务只有请求和指示

是否面向连接：

- **面向连接服务** ： 包含建立连接、传输数据、释放连接三阶段    `TCP`
- **无连接服务** ：尽最大努力交付  `IP` 、 `UDP`

是否可靠：

- **可靠服务**
- **不可靠服务** ： 尽力而为，有时候可在用户的帮助下变为可靠

有无应答：

- **有应答服务** ：系统实现，不是用户实现	`文件传输服务`
- **无应答服务** ： 也可以由更高层实现应答    `WWW服务`



<br>



### 1.2.3 OSI参考模型和TCP/IP模型

#### OSI七层模型 

**物数网传会表应** 

低三层为 ： `通信子网`

高三层为 ： `资源子网`

- **物理层 Physical Layer**

    传输单位： `比特`

    在物理媒体（双绞线、光缆等，在物理层下面，也被称为第0层）上为数据端设备透明地传输 `原始比特流`

    定义了 `数据终端设备DTE` 和 `数据通信设备DCE` 的物理和逻辑链接方法

    物理层协议也称为 `物理层接口标准` 或者 `物理层规程`

    典型的协议 ： `EIA-232C` 、 `EIA/TIA RS-449` 、 `CCITT的X.21` 等

- **数据链路层 Data Link Layer**

    传输单位： `帧`

    任务是 将网络层传来的IP数据报组装成帧

    **点对点（主机和主机之间）** 

    功能 ： 成帧、差错控制、流量控制、传输管理

    `介质访问子层` ： 控制对共享信道的访问

    典型的协议 ： `SDLC` 、`HDLC` 、 `PPP` 、 `STP` 、 `帧中继`

- **网络层 Network Layer**

    传输单位： `数据报`

    任务是 把网络层的协议数据单元（分组）从源端发送到目的端，提供通信服务给分组交换网上的主机

    功能 ： 路由选择、流量控制、拥塞控制、差错控制、网际互联

    Internet的网络层也称为 `网际层` or `IP层`

    典型的协议： `IP` 、 `IPX` 、 `ICMP` 、 `ARP` 、 `RARP` 、 `OSPF`

- **传输层 Transport Layer**

    也称 `运输层` ，传输单位： `报文段(TCP)或者用户数据报(UDP)`

    功能 ： 为 **端对端（进程和进程之间）** 提供可靠的传输服务，而忽略通信子网

    且有复用和分用的功能：

    - `复用` ： 多个应用层进程可以同时使用传输层的服务

    - `分用` ： 传输层把收到的信息分贝交付给应用层中相应的进程 

- **会话层Session Layer**

    允许不同主机的进程进行对话

    利用传输层提供的端对端服务，向表示层提供增值服务

    为表示层实体或用户进程建立链接并在链接上有序传输数据（就是会话），也称 **建立同步SYN**

- **表示层 Presentation Layer**

    处理两个通信系统中交换信息的表示方式

    数据压缩、加密、解密等

- **应用层 Application Layer**

    是用户和网络的界面

    典型的协议 ：  `文件FTP` 、 `邮件SMTP` 、 `HTTP`



<br>



#### TCP/IP模型

ARPA研究 `ARPAnet` 时提出

**事实上的国际标准**

- **应用层（会 + 表 + 应）**

    用户-用户

    包含所有的高层协议 ： `虚拟终端协议Telnet` 、 `文件传输协议FTP` 、`域名解析服务DNS` 、 `电子邮件协议SMTP` 、 `超文本传输协议HTTP`

- **传输层**

    `应用-应用` 或 `进程-进程`

    传输层的两个主要协议：

    - `传输控制协议TCP` ： 面向 `连接` ，传输 `报文段` ， `可靠`
    - `用户数据报协议UDP` ：面向 `无连接` ，传输 `用户数据报` ，`不可靠` ， 尽最大努力交付

- **网际层**

    关键

    将分组发送到任何网络，并为之独立选择合适的路由，但不保证分组有序到达

    分组的有序交付由高层负责

    定义了标准的分组格式和协议： `IP` ，现在的版本就是 `IPv4`

    ```
    IP协议是因特网的核心协议
    ```

    

- **网络接口层（物 + 数）**

    表示与物理网络的接口， **实际上并未真正描述**

    具体的物理网络可以是各种局域网，例如以太网、令牌环网、电话网

    作用 ： 从主机或结点接受IP分组，并发送到指定的物理网络上



<br>



#### TCP/IP和OSI的比较

相似点：

- 都是分层结构
- 基于独立的协议栈的概念
- 都能解决异构网络的互联

差异点：

- OSI精确定义了三个主要概念：服务、协议、接口，符合面向对象的思想。而TCP/IP没有

- OSI先有模型再有协议，而TCP/IP现有IP协议再有模型

- 重点：

    **OSI模型** 在 `网络层` 支持 `面向连接` 和 `无连接` 的通信，在 `传输层` 只有 `面向连接` 的通信

    **TCP/IP模型** 在 `网际层` 只有 `无连接` 的通信，在 `传输层` 支持 `面向连接` 和 `无连接` 的通信

《计算机网络》一般采用折中的方法，采用5层结构：

- 物理层
- 数据链路层
- 网络层
- 传输层
- 应用层



<br>



#### 协议栈封装



<br>



### 1.2.4 习题

#### 选择题：

1. `定义功能执行的方法` 不是对网络模型进行分层的目标

2. OSI模型中数据链路层不具有 `拥塞控制` 功能

3. 最好描述OSI模型汇总数据链路层功能的是 `保证数据正确的顺序和完整性`

4. OSI模型中，两台计算机进行文件传输时，为防止中间出现网络故障而重传整个文件，通过在文件中插入同步结点。这个动作发生在 `会话层`

5. 正确描述了OSI参考模型中数据的封装过程的是 `网络层将高层协议产生的数据封装成分组，并增加第三层的地址和控制信息`

6. OSI模型中，提供流量控制的是 `2、3、4` 层

7. TCP/IP模型中， `传输层` 处理关于可靠性、流量控制、错误校正等问题

8. 【2016】在OSI参考模型中，路由器、交换机switch、集线器hub实现的最高功能层分别是 `2、2、2`

    



# 第二章 物理层

## 2.1 信道基础

### 2.1.1 基础概念

数据 ： 传送信息的实体

信号 ： 数据的电气或电磁表现，是数据在传输过程中的存在形式

- 连续变化 ： 模拟XX
- 离散 ： 数字XX

码元 ： 用一个固定时长（码元宽度）的数字脉冲表示一位K进程数，代表不同离散值的基本波形，是数字信号的基本计量单位



<br>



信源 ： 起点

信宿 ： 终点

信道 ： 信号的传输媒介，一条线路的逻辑部件，一般通信线都有一条发送信道和一条接受信道



<br>



`基带信号` ： 将数字信号1和0用不同电压表示，在 `数字信道` 上传输（基带传输）

`宽带信号` ： 基带信号调制后形成 `频分复用模拟信号` ，在 `模拟信道` 上传输（宽带传输）



<br>



信息交互方式又可以分为：

- `单向通信` ：一条信道，单向
- `半双工通信` ：两条信道，但不能同时发送和接受
- `全双工通信` ：两条信道，可同时发送和接受

信道的极限容量 ： 信道的 `最高码元传输速率` or `信道的极限数据传输速率` 



<br>



速率（数据率） ： 单位时间内传输的数据量，可以用下面两个来表示：

- `码元传输速率（波特率、调制速率、波形速率、符号速率）`
    - 单位 ： 波特baud ， 一波特为每秒传一个码元（码元速率和进制数k无关）
- `信息传输速率（比特率、信息速率）` 
    - 单位 ： 比特每秒b/s ， 单位时间传输的 `二进制码元` （也就是比特数）个数

```
两个速率概念不同，但数量上有一定的关系
若一个码元带n比特信息，
在数值上， 比特率 = 波特率 * 每符号含的比特数（若1码元=n比特，则波特率=n比特率）

比特率 = 波特率 * log(2为底)N ， N为有效离散值的个数，log(2为底)N也就是二进制位数
```



<br>



带宽 ： 单位b/s ， 单位时间内从网络一点到另一点能通过的 `最高数据率`



<br>



### 2.1.2 奈奎斯特定理和香农定理

`码间串扰` ： 信号中的高频分量往往不能通过信道，否则会在传输中衰减，导致接收端的信号波形失去码元间的清晰界限

#### 奈氏准则 ：限制码元传输速率

具体信道能通过的频率范围是有限的

在理想低通（没有噪声、带宽有限）的信道中，为了避免码间串扰，极限码元传输速率为2W（W是该信道带宽）波特

```
理想低通信道下的 极限数据传输速率 = 2Wlog（2为底）V， 单位b/s

V表示每个码元离散电平的数目（有多少种组合，比如4个二进制位可以表示16种不同的码元，此时数据传输率是码元数据传输率的4倍）
```

结论：

- 任何信道，码元传输速率有上限
- 频带越宽（通过的信号高频分量越多），可用更好的速率进行码元的有效传播
- 奈式准则没有对 `一个码元对应多少二进制位，也就是上面的V` 做出限制



<br>



#### 香农定理 ：计算数据传输速率

给出了带宽有限且有噪声的信道的极限数据传输速率，此时能做到不会有误差

```
信道的极限数据传输速率 = Wlog(2为底)(1 + S/N) 	单位b/s

W为信道带宽
S为信道传输信号的平均攻略
N为信号内部的高速噪声功率
信噪比 = 10log(10为底)(S/N) 单位dB 
```

结论：

- 带宽或信噪比越大，极限传输速率越高
- 一定带宽和一定信噪比，上限是固定的
- 只要地域极限传输速率，就能做到无差错的传输
- 一个码元对应的二进制位数是有限的



<br>



### 2.1.3 编码与调制（先跳过）

数字/模拟数据必须转化为信号来传输

`编码` ： 数据变为数字信号

`调制` ： 数据变为模拟信号

- 数字数据 ：转数字信号（数字发送器）、转模拟信号（调制器）
- 模拟数据 ：转数字信号（PCM编码器）、转模拟信号（放大器调制器）

因此就有下面四中编码方式：

**数字数据编码为数字信号**

用于 `基带传输`

不改变数字数据信号频率，直接传输数字信号

编码 ： 以某种规则区分0和1

常用的编码规则：

- 归零编码

- 非归零编码

- 反向非归零编码

- 曼切斯特编码 **重点**

    将一个码元等分为二：前高后低表示1，反之表示0

    特点 ： `每个码元中间电平跳变`

    跳变既可作为同步用的时钟信号，也能作为数据信号

    **占频带宽度是原始基带宽度的2倍**

    **以太网使用的就是曼切斯特编码**

- 差分曼切斯特编码

    讲一个码元等分为二：1前半部分和上半个部分相同，0和前半部分相反，都在中间跳变

    可以实现自同步

    **抗干扰性较好**

    **常用于局域网**

- 4B/5B编码



<br>



数字数据调制为模拟信号

模拟数据编码为数字信号

模拟数据调制为模拟信号



<br>



### 2.1.4 电路交换、报文交换、分组交换

此处的交换就是按某种方式，动态分配传输线路的资源

#### 电路交换

先建立一条专用（双方独占）的物理链路（经过很多中间节点），知道通信结束才释放

分为 `建立连接` 、 `数据传输` 、 `链接释放` 三个阶段

传输过程中 ， `用户始终占用端到端的固定传输带宽`

任何结点都是直通接受和发送， `不存在存储转发消耗的时间`

优点：

- 时延小
- 有序传输
- 没有冲突
- 范围广：模拟和数字都可以
- 实时性强：建立通道后随时通信
- 控制简单

缺点：

- 建立连接时间长
- 线路独占，使用率低
- 灵活性差
- 难以规格化：不同终端难以通信



<br>



#### 报文交换（早期电报）

数据交换的单位是 `报文` ，有目标地址、源地址等信息

在交换结点采用 `存储转发` 传输方式

优点：

- 无需建立连接
- 动态分配路线（也同时提高了可靠性和利用率）
- 提供多目标服务：可以AOE了

缺点：

- 存储转发引起的时延：接受、校验、排队、发送等时间
- 网络结点需要右较大的缓存空间



<br>



#### 分组交换（更先进）

数据交换的单位是 `分组Packet` ，是将大报文分成了小块再加上控制信息组成的

在交换结点采用 `存储转发` 传输方式，根据控制信息选择下一结点

优点：

- 无需建立连接
- 线路利用率高
- 简化了存储管理：（因为分组长度固定，缓冲区好设置）
- 加速传输（和报文交换比）：流水线方式
- 可靠性高

缺点：

- 传输时延
- 额外信息量
- 采用数据报服务时，失序、丢失、重复分组问题
- 采用虚电路服务是，建立、传输、释放的时间消耗



<br>



总结：

- 数据量大、传送时间远大于呼叫时间时：选电路交换
- 端对端的通路由多段链路组成 ： 选分组交换



<br>



### 2.1.5 数据报和虚电路

是 `分组交换` 的两重方式，都由 `网络层` 提供

#### 数据报方式（无连接）

端系统中，高层协议将报文拆成若干带序号的有序单元，在网络层加上控制信息后组成 `数据报分组（网络层的PDU）`

中间节点查看 转发表 找到最佳路由后，尽快转发每个分组，路径和达到顺序均不固定，最终到达终点

采用 存储转发技术

特点：

- 不需要链接，不独占链路，利用率高

- 尽最大努力交付

- 分组中包含发送端和接收端的完整地址，能独立传输

- 存储转发会带来排队，交换结点可能根据情况丢弃部分分组

- 冗余链路：对故障的适应力强

- 存储转发的延时小，网络吞吐量提高

    



<br>



#### 虚电路方式（面向连接）

结合了数据报方式和电路交换的优点

分组发送之前，建立一条 `逻辑上相连的虚电路` ，建立后就固定了物理路径

也有建立、传输、释放三个阶段

建立虚电路时，选择一个 `未使用的虚电路号` 用于区别其他虚电路

每个数据分组有分组号、校验、控制、虚电路号等信息

网络中每个结点维护一个 `虚电路表` 

以上信息在建立虚电路过程中确定

数据双向传输

特点：

- 建立和释放需要开销，对于长时间、频繁的交换 效率高
- 路由选择体现在建立阶段
- 可靠（注意确认消息的传输时高层实现，和网络层无关）
- 致命缺点，一个结点故障，则所有经过该结点的都故障
- 分组不含目的地之，只有虚电路标识符



![第二章_数据报和虚电路](assets/计算机网络_笔记/第二章_数据报和虚电路.png)



<br>



### 2.1.6 习题

#### 选择题：

1. `并行传输` 常用于计算机内部的数据传输
2. 可以把语音信号数字化的技术是 `脉冲编码调制`
3. 利用模拟通信信道传输数字信号的方法称为 `频带传输`
4. 波特率等于 `每秒可能发生的信号变化数`
5. 测得一个以太网的数据波特率是 40MBaud ，那么其数据率是 `20Mb/s`
6. 某信道的波特率为 1000Baud，若令其数据传输率达到4kb/s，则一个信号码元所取的有效离散值个数为 `16`



<br>



## 2.2 传输介质

### 2.2.1 双绞线、同轴电缆、光纤、无线传输介质



<br>



### 2.2.2 物理层接口的特性



<br>



### 2.2.3 习题



<br>



## 2.3 物理层设备

### 2.3.1 中继器



<br>



### 2.3.2 集线器Hub



<br>



### 2.3.3 习题



<br>
