参考资料：《23王道计算机网络》

<hr>

# 第一章 计算机网络体系结构

## 1.1 计算机网络概述

### 重点

### 1.1.1 计算机网络概念

**计算机网络** ： 能够以相互共享资源的方式互联起来的自治计算机系统的集合

- `目的` ： 资源共享
- `组成单元` ： 多台多里的自治计算机
- `规则` ： 网络协议



<br>



### 1.1.2 计算机网络组成

按 **组成成分** 可以分为：

- `硬件` ：主机、通信链路、通行处理机（网卡）等
- `软件` ： 网络操作系统、FTP程序等
- `协议`

按 **工作方式** 可以分为：

- 边缘部分 ：用户用的主机
- 核心部分 ：大量网络和路由器

按 **功能组成** 可以分成：

- `通信子网` ： 传输介质、通信设备、网络协议
- `资源子网` ： 实现资源共享功能的软硬件集合



<br>



### 1.1.3 计算机网络功能

主要有五大功能：

1. 数据通信
2. 资源共享
3. 分布式处理
4. 提高可靠性
5. 负载均衡



<br>



### 1.1.4 计算机网络分类

按 **分布范围** 可分为：

- 广域网WAN ： 也叫远程网，长距离通信，使用 **交换技术**
- 城域网MAN ： 覆盖一个城市，采用 **以太网技术** ，有时也在局域网的范围
- `局域网LAN` ： 使用 **广播技术**
- 个人区域网PAN ： 一个人的设备，也叫无线个人区域网WPAN



<br>



按 **传输技术** 可分为：

- `广播式网络` ：局域网，广域网中的无线、卫星通信网络
- `点对点网络` ：广域网

区分广播和点对点 ：是否采用 **分组存储转发** 和 **路由选择机制**



<br>



按 **拓扑结构** 可分为：

- 网状 

- 总线形 

- `星形` ： 通信必须经过中央设备（路由器或交换机）

- 环形 ： 令牌环局域网，环中信号单向

网状一般是广域网，其他是局域网



<br>



按 **交换技术** 可分为：

- **电路交换网络** 
    - 传统电话网路
    - 优 ： 直接传送，时延小
    - 缺 ： 线路利用率低、不能差错控制
- **报文交换网路**
    - 也叫 `存储-转发网络`
    - 优 ： 充分利用线路，可以实现格式转换、差错控制
    - 缺 ： 增加了缓冲时延，缓冲区难以管理
- **分组交换网络**
    - 也叫 `包交换网络` ，现在的主流
    - 优 ： 缓冲便于管理、包的平均时延小，更标准化
    - 缺 ： 附加信息开销大



<br>



### 1.1.6 计算机网络的性能指标

#### 带宽Bandwidth

网络的通信线路所能传送数据的能力，比特/秒（b/s）



<br>



#### 时延Delay

指数据（报文或分组）从链路的一段到另一端所需的总时间，总时延包括四部分：

- **发送时延（传输时延）**

    将分组的所有比特 传输到链路 所需的时间（发送分组的第一个比特到最后一个比特发送完毕）

    ```
    发送时延 = 分组长度 / 信道宽度
    ```

    

- **传播时延**

    一个比特从链路的一端到另一端所需的时间

    ```
    传播时延 = 信道长度 / 电磁波在信道上的传播速率
    ```

    

- **处理时延**

    数据在 交换结点 中处理存储转发的准备时间

    比如拆分组的首部、从分组中提取数据部分、差错检验、查找合适的路由等

- **排队时延**

    分组以进入路由器后排队等待转发的过程

注意 ： 

- `处理时延` 和 `排队时延` 一般可忽略不计
- 高速链路提高的是 `数据发送速率` 而非比特在链路上的传播速率，因此只能 `减少数据的发送时延`



<br>



#### 时延带宽积

发送端发送第一个比特即将到达终点时，发送端已经发出了多少比例

也称 **以比特为单位的链路长度**

```
时延带宽积 = 传播时延 * 信道带宽

将链路想象成一根圆柱
长度就是传播时延
横截面就是链路带宽
圆柱的体积就是时延带宽积，也就是能容纳的比特的数量
```



<br>



#### 往返时延RTT

指从发送端发送一个短分组，到发送端接收接收端的确认（假设接收后立马发送确认）总共经历的时间



<br>



#### 吞吐量Throughput

单位时间内通过某个网络的数据量



<br>



#### 速率Speed

连接到计算机网络的主机在数字信道上传输数据的速率

也称为 **数据传输率** 、 **数据率** 、 **比特率**

kb/s	Mb/s	Gb/s

最高数据传输率也称为 **带宽**



<br>



#### 信道利用率

指有百分之多少的时间是有数据通过的

```
信道利用率 = 有数据通过时间 / (有+无)数据通过时间
```



<br>



### 1.1.7 习题

#### 选择题

1. 计算机网络最基本的功能室 `数据通信`

2. 广播式网络不需要服务结点 `错误`

    ```
    广播式网络共享广播信道（如总线），通常是局域网（工作在数据链路层）中的一种通信方式，因此不需要网络层，也不存在路由选择问题
    但必须使用物理层的服务，必须要通过服务访问点实现
    ```

    

3. 世界上最早出现的计算机网络是 `ARPnet`



<br>



## 1.2 计算机网络体系结构与参考模型

### 1.2.1 计算机网络分层结构

网络的体系结构 ： 计网各层及协议的集合

体系结构是抽象的，实现是具体的

在分层结构中，第n层中的活动元素称为 `第n层实体` ，实体指任何可发送或接受信息的硬件或软件进程

不同机器同一层称为 `对等层` ，同一层的实体称为 `对等实体`

**协议数据单元PDU：**

- 对等层之前传送的数据单位称为该层的PDU，第n层为 n-PDU
- PDU的通称 ：物理层-比特、数据链路层-帧、网络层-分组、传输层-报文段

每层中，报文（也就是PDU）分为：

- `服务数据单元SDU` ： 读n层的服务数据单元记为 n-SDU，数据部分
- `协议控制信息PCI` ：第n层的协议控制信息记为 n-PCI，控制信息部分

```
n-SDU + n-PCI = n-PDU = (n-1)-SDU
第n层的报文PDU作为下一层的数据部分SDU
依次往下传
最后到物理层就是一个层层嵌套的PDU，再进行传送，接收方再层层接触嵌套
```

补充：

- 只能通过接口使用下一层的服务，且细节是透明的
- 两台主机通信事，对等层在逻辑上有一条直接信道，表现为不经过下层就能传送信息



<br>



### 1.2.2 协议、接口、服务

#### 网络协议Network Protocol 

是对等实体之间的协议，包括：

- 语法 ：规定了传输数据的格式
- 语义 ：规定了要完成的功能、控制信息等
- 同步 ：规定了顺序



<br>



#### 接口

同一结点相邻两层的实体通过 **服务访问点SAP（逻辑上的）** 进行交互

服务通过SAP提供给上层使用，第n层的SAP就是n+1层访问n层服务的地方 



<br>



#### 服务

服务是垂直的，下层为上层提供的功能调用

服务原语 ： 上层使用下层的服务时必须与下层交换的命令

OSI模型中的服务原语：

- 请求request
- 响应response
- 指示indication
- 证实confirmation

有应答服务包括4种，无应答服务只有请求和指示

是否面向连接：

- **面向连接服务** ： 包含建立连接、传输数据、释放连接三阶段    `TCP`
- **无连接服务** ：尽最大努力交付  `IP` 、 `UDP`

是否可靠：

- **可靠服务**
- **不可靠服务** ： 尽力而为，有时候可在用户的帮助下变为可靠

有无应答：

- **有应答服务** ：系统实现，不是用户实现	`文件传输服务`
- **无应答服务** ： 也可以由更高层实现应答    `WWW服务`



<br>



### 1.2.3 OSI参考模型和TCP/IP模型

#### OSI七层模型 

**物数网传会表应** 

低三层为 ： `通信子网`

高三层为 ： `资源子网`

- **物理层 Physical Layer**

    传输单位： `比特`

    在物理媒体（双绞线、光缆等，在物理层下面，也被称为第0层）上为数据端设备透明地传输 `原始比特流`

    定义了 `数据终端设备DTE` 和 `数据通信设备DCE` 的物理和逻辑链接方法

    物理层协议也称为 `物理层接口标准` 或者 `物理层规程`

    典型的协议 ： `EIA-232C` 、 `EIA/TIA RS-449` 、 `CCITT的X.21` 等

- **数据链路层 Data Link Layer**

    传输单位： `帧`

    任务是 将网络层传来的IP数据报组装成帧

    **点对点（主机和主机之间）** 

    功能 ： 成帧、差错控制、流量控制、传输管理

    `介质访问子层` ： 控制对共享信道的访问

    典型的协议 ： `SDLC` 、`HDLC` 、 `PPP` 、 `STP` 、 `帧中继`

- **网络层 Network Layer**

    传输单位： `数据报`

    任务是 把网络层的协议数据单元（分组）从源端发送到目的端，提供通信服务给分组交换网上的主机

    功能 ： 路由选择、流量控制、拥塞控制、差错控制、网际互联

    Internet的网络层也称为 `网际层` or `IP层`

    典型的协议： `IP` 、 `IPX` 、 `ICMP` 、 `ARP` 、 `RARP` 、 `OSPF`

- **传输层 Transport Layer**

    也称 `运输层` ，传输单位： `报文段(TCP)或者用户数据报(UDP)`

    功能 ： 为 **端对端（进程和进程之间）** 提供可靠的传输服务，而忽略通信子网

    且有复用和分用的功能：

    - `复用` ： 多个应用层进程可以同时使用传输层的服务

    - `分用` ： 传输层把收到的信息分贝交付给应用层中相应的进程 

- **会话层Session Layer**

    允许不同主机的进程进行对话

    利用传输层提供的端对端服务，向表示层提供增值服务

    为表示层实体或用户进程建立链接并在链接上有序传输数据（就是会话），也称 **建立同步SYN**

- **表示层 Presentation Layer**

    处理两个通信系统中交换信息的表示方式

    数据压缩、加密、解密等

- **应用层 Application Layer**

    是用户和网络的界面

    典型的协议 ：  `文件FTP` 、 `邮件SMTP` 、 `HTTP`



<br>



#### TCP/IP模型

ARPA研究 `ARPAnet` 时提出

**事实上的国际标准**

- **应用层（会 + 表 + 应）**

    用户-用户

    包含所有的高层协议 ： `虚拟终端协议Telnet` 、 `文件传输协议FTP` 、`域名解析服务DNS` 、 `电子邮件协议SMTP` 、 `超文本传输协议HTTP`

- **传输层**

    `应用-应用` 或 `进程-进程`

    传输层的两个主要协议：

    - `传输控制协议TCP` ： 面向 `连接` ，传输 `报文段` ， `可靠`
    - `用户数据报协议UDP` ：面向 `无连接` ，传输 `用户数据报` ，`不可靠` ， 尽最大努力交付

- **网际层**

    关键

    将分组发送到任何网络，并为之独立选择合适的路由，但不保证分组有序到达

    分组的有序交付由高层负责

    定义了标准的分组格式和协议： `IP` ，现在的版本就是 `IPv4`

    ```
    IP协议是因特网的核心协议
    ```

    

- **网络接口层（物 + 数）**

    表示与物理网络的接口， **实际上并未真正描述**

    具体的物理网络可以是各种局域网，例如以太网、令牌环网、电话网

    作用 ： 从主机或结点接受IP分组，并发送到指定的物理网络上



<br>



#### TCP/IP和OSI的比较

相似点：

- 都是分层结构
- 基于独立的协议栈的概念
- 都能解决异构网络的互联

差异点：

- OSI精确定义了三个主要概念：服务、协议、接口，符合面向对象的思想。而TCP/IP没有

- OSI先有模型再有协议，而TCP/IP现有IP协议再有模型

- 重点：

    **OSI模型** 在 `网络层` 支持 `面向连接` 和 `无连接` 的通信，在 `传输层` 只有 `面向连接` 的通信

    **TCP/IP模型** 在 `网际层` 只有 `无连接` 的通信，在 `传输层` 支持 `面向连接` 和 `无连接` 的通信

《计算机网络》一般采用折中的方法，采用5层结构：

- 物理层
- 数据链路层
- 网络层
- 传输层
- 应用层



<br>



#### 协议栈封装



<br>



### 1.2.4 习题

#### 选择题：

1. `定义功能执行的方法` 不是对网络模型进行分层的目标

2. OSI模型中数据链路层不具有 `拥塞控制` 功能

3. 最好描述OSI模型汇总数据链路层功能的是 `保证数据正确的顺序和完整性`

4. OSI模型中，两台计算机进行文件传输时，为防止中间出现网络故障而重传整个文件，通过在文件中插入同步结点。这个动作发生在 `会话层`

5. 正确描述了OSI参考模型中数据的封装过程的是 `网络层将高层协议产生的数据封装成分组，并增加第三层的地址和控制信息`

6. OSI模型中，提供流量控制的是 `2、3、4` 层

7. TCP/IP模型中， `传输层` 处理关于可靠性、流量控制、错误校正等问题

8. 【2016】在OSI参考模型中，路由器、交换机switch、集线器hub实现的最高功能层分别是 `2、2、2`

    



# 第二章 物理层

## 2.1 信道基础

### 2.1.1 基础概念

数据 ： 传送信息的实体

信号 ： 数据的电气或电磁表现，是数据在传输过程中的存在形式

- 连续变化 ： 模拟XX
- 离散 ： 数字XX

码元 ： 用一个固定时长（码元宽度）的数字脉冲表示一位K进程数，代表不同离散值的基本波形，是数字信号的基本计量单位



<br>



信源 ： 起点

信宿 ： 终点

信道 ： 信号的传输媒介，一条线路的逻辑部件，一般通信线都有一条发送信道和一条接受信道



<br>



`基带信号` ： 将数字信号1和0用不同电压表示，在 `数字信道` 上传输（基带传输）

`宽带信号` ： 基带信号调制后形成 `频分复用模拟信号` ，在 `模拟信道` 上传输（宽带传输）



<br>



信息交互方式又可以分为：

- `单向通信` ：一条信道，单向
- `半双工通信` ：两条信道，但不能同时发送和接受
- `全双工通信` ：两条信道，可同时发送和接受

信道的极限容量 ： 信道的 `最高码元传输速率` or `信道的极限数据传输速率` 



<br>



速率（数据率） ： 单位时间内传输的数据量，可以用下面两个来表示：

- `码元传输速率（波特率、调制速率、波形速率、符号速率）`
    - 单位 ： 波特baud ， 一波特为每秒传一个码元（码元速率和进制数k无关）
- `信息传输速率（比特率、信息速率）` 
    - 单位 ： 比特每秒b/s ， 单位时间传输的 `二进制码元` （也就是比特数）个数

```
两个速率概念不同，但数量上有一定的关系
若一个码元带n比特信息，
在数值上， 比特率 = 波特率 * 每符号含的比特数（若1码元=n比特，则波特率=n比特率）

比特率 = 波特率 * log(2为底)N ， N为有效离散值的个数，log(2为底)N也就是二进制位数
```



<br>



带宽 ： 单位b/s ， 单位时间内从网络一点到另一点能通过的 `最高数据率`



<br>



### 2.1.2 奈奎斯特定理和香农定理

`码间串扰` ： 信号中的高频分量往往不能通过信道，否则会在传输中衰减，导致接收端的信号波形失去码元间的清晰界限

#### 奈氏准则 ：限制码元传输速率

具体信道能通过的频率范围是有限的

在理想低通（没有噪声、带宽有限）的信道中，为了避免码间串扰，极限码元传输速率为2W（W是该信道带宽）波特

```
理想低通信道下的 极限数据传输速率 = 2Wlog（2为底）V， 单位b/s

V表示每个码元离散电平的数目（有多少种组合，比如4个二进制位可以表示16种不同的码元，此时数据传输率是码元数据传输率的4倍）
```

结论：

- 任何信道，码元传输速率有上限
- 频带越宽（通过的信号高频分量越多），可用更好的速率进行码元的有效传播
- 奈式准则没有对 `一个码元对应多少二进制位，也就是上面的V` 做出限制



<br>



#### 香农定理 ：计算数据传输速率

给出了带宽有限且有噪声的信道的极限数据传输速率，此时能做到不会有误差

```
信道的极限数据传输速率 = Wlog(2为底)(1 + S/N) 	单位b/s

W为信道带宽
S为信道传输信号的平均攻略
N为信号内部的高速噪声功率
信噪比 = 10log(10为底)(S/N) 单位dB 
```

结论：

- 带宽或信噪比越大，极限传输速率越高
- 一定带宽和一定信噪比，上限是固定的
- 只要地域极限传输速率，就能做到无差错的传输
- 一个码元对应的二进制位数是有限的



<br>



### 2.1.3 编码与调制（先跳过）

数字/模拟数据必须转化为信号来传输

`编码` ： 数据变为数字信号

`调制` ： 数据变为模拟信号

- 数字数据 ：转数字信号（数字发送器）、转模拟信号（调制器）
- 模拟数据 ：转数字信号（PCM编码器）、转模拟信号（放大器调制器）

因此就有下面四中编码方式：

**数字数据编码为数字信号**

用于 `基带传输`

不改变数字数据信号频率，直接传输数字信号

编码 ： 以某种规则区分0和1

常用的编码规则：

- 归零编码

- 非归零编码

- 反向非归零编码

- 曼切斯特编码 **重点**

    将一个码元等分为二：前高后低表示1，反之表示0

    特点 ： `每个码元中间电平跳变`

    跳变既可作为同步用的时钟信号，也能作为数据信号

    **占频带宽度是原始基带宽度的2倍**

    **以太网使用的就是曼切斯特编码**

- 差分曼切斯特编码

    讲一个码元等分为二：1前半部分和上半个部分相同，0和前半部分相反，都在中间跳变

    可以实现自同步

    **抗干扰性较好**

    **常用于局域网**

- 4B/5B编码



<br>



数字数据调制为模拟信号

模拟数据编码为数字信号

模拟数据调制为模拟信号



<br>



### 2.1.4 电路交换、报文交换、分组交换

此处的交换就是按某种方式，动态分配传输线路的资源

#### 电路交换

先建立一条专用（双方独占）的物理链路（经过很多中间节点），知道通信结束才释放

分为 `建立连接` 、 `数据传输` 、 `链接释放` 三个阶段

传输过程中 ， `用户始终占用端到端的固定传输带宽`

任何结点都是直通接受和发送， `不存在存储转发消耗的时间`

优点：

- 时延小
- 有序传输
- 没有冲突
- 范围广：模拟和数字都可以
- 实时性强：建立通道后随时通信
- 控制简单

缺点：

- 建立连接时间长
- 线路独占，使用率低
- 灵活性差
- 难以规格化：不同终端难以通信



<br>



#### 报文交换（早期电报）

数据交换的单位是 `报文` ，有目标地址、源地址等信息

在交换结点采用 `存储转发` 传输方式

优点：

- 无需建立连接
- 动态分配路线（也同时提高了可靠性和利用率）
- 提供多目标服务：可以AOE了

缺点：

- 存储转发引起的时延：接受、校验、排队、发送等时间
- 网络结点需要右较大的缓存空间



<br>



#### 分组交换（更先进）

数据交换的单位是 `分组Packet` ，是将大报文分成了小块再加上控制信息组成的

在交换结点采用 `存储转发` 传输方式，根据控制信息选择下一结点

优点：

- 无需建立连接
- 线路利用率高
- 简化了存储管理：（因为分组长度固定，缓冲区好设置）
- 加速传输（和报文交换比）：流水线方式
- 可靠性高

缺点：

- 传输时延
- 额外信息量
- 采用数据报服务时，失序、丢失、重复分组问题
- 采用虚电路服务是，建立、传输、释放的时间消耗



<br>



总结：

- 数据量大、传送时间远大于呼叫时间时：选电路交换
- 端对端的通路由多段链路组成 ： 选分组交换



<br>



### 2.1.5 数据报和虚电路

是 `分组交换` 的两重方式，都由 `网络层` 提供

#### 数据报方式（无连接）

端系统中，高层协议将报文拆成若干带序号的有序单元，在网络层加上控制信息后组成 `数据报分组（网络层的PDU）`

中间节点查看 转发表 找到最佳路由后，尽快转发每个分组，路径和达到顺序均不固定，最终到达终点

采用 存储转发技术

特点：

- 不需要链接，不独占链路，利用率高

- 尽最大努力交付

- 分组中包含发送端和接收端的完整地址，能独立传输

- 存储转发会带来排队，交换结点可能根据情况丢弃部分分组

- 冗余链路：对故障的适应力强

- 存储转发的延时小，网络吞吐量提高

    



<br>



#### 虚电路方式（面向连接）

结合了数据报方式和电路交换的优点

分组发送之前，建立一条 `逻辑上相连的虚电路` ，建立后就固定了物理路径

也有建立、传输、释放三个阶段

建立虚电路时，选择一个 `未使用的虚电路号` 用于区别其他虚电路

每个数据分组有分组号、校验、控制、虚电路号等信息

网络中每个结点维护一个 `虚电路表` 

以上信息在建立虚电路过程中确定

数据双向传输

特点：

- 建立和释放需要开销，对于长时间、频繁的交换 效率高
- 路由选择体现在建立阶段
- 可靠（注意确认消息的传输时高层实现，和网络层无关）
- 致命缺点，一个结点故障，则所有经过该结点的都故障
- 分组不含目的地址，只有虚电路标识符



![第二章_数据报和虚电路](assets/计算机网络_笔记/第二章_数据报和虚电路.png)



<br>



### 2.1.6 习题

#### 选择题：

1. `并行传输` 常用于计算机内部的数据传输
2. 可以把语音信号数字化的技术是 `脉冲编码调制`
3. 利用模拟通信信道传输数字信号的方法称为 `频带传输`
4. 波特率等于 `每秒可能发生的信号变化数`
5. 测得一个以太网的数据波特率是 40MBaud ，那么其数据率是 `20Mb/s`
6. 某信道的波特率为 1000Baud，若令其数据传输率达到4kb/s，则一个信号码元所取的有效离散值个数为 `16`



<br>



## 2.2 传输介质

传输介质也叫传输媒体，是数据传输系统中发送设备和接收设备之间的物理通路

### 2.2.1 双绞线、同轴电缆、光纤、无线传输介质

**双绞线**

由两根用一定规则并排绞合的、相互绝缘的铜导线组成

- `绞合的目的` ： 减少对相邻导线的电磁干扰
- `屏蔽双绞线STP` ： 双绞线外层还有一根金属屏蔽层
- `非屏蔽双绞线UTP` ： 没有屏蔽层
- 在局域网和传统电话网中普遍使用
- 距离太远时：
    - 模拟传输：用放大器放大信号
    - 数字传输：用中继器整形再生



<br>



**同轴电缆**

从里到外分别是：内导体、绝缘层、网状编织屏蔽层、塑料外层

- 50欧 ： 主要用于传输基带数字信号， `基带同轴电缆`
- 75欧 ： 主要用于传输宽带模拟信号， `宽带同轴电缆` ，主要用于有限电视系统
- 和双绞线比，抗干扰能力强，但比较贵



<br>



**光纤**

利用光导纤维传递光脉冲来进行通信，有表示1，无表示0

- `多模光纤` ：利用 **光的全反射特性** ，光源为 **发光二极管** ，只适用于近距离传输
- `单模光纤` ：光纤的直径减少到只有一个光的波长，就能一直向前，不会多次反射，因此衰减较少，适合远距离传输

光纤的优点：

- 传输损耗少，中继距离长
- 抗雷电和电磁干扰性强
- 无串音干扰，保密性好
- 体积小，重量轻



<br>



**无线传输介质**

- 无线电波：WLAN
- 微波、红外线、激光：需要起点和重点存在一条视线通路，有方向性，直线传播，因此也称为 `视线介质`
- 卫星通信：优点是容量大、距离远、覆盖广。缺点是保密性差、端对端时延长



<br>



### 2.2.2 物理层接口的特性

物理层需要屏蔽硬件、线路、通信方式的差异，让数据链路层值需要考虑如何完成本层的协议和服务

物理层主要任务为描述接口的一些特性：

- 机械特性 ： 物理器件的形状、尺寸、引脚数据、排列等
- 电气特性 ： 各条线的电压范围
- 功能特性 ： 指出某条线的某一电平是什么意义
- 过程特性 ： 也叫 `规程特性` ， 先后顺序

常用的物理层接口标准：

- EIA RS-232-C
- ADSL
- SONET/SDH



<br>



### 2.2.3 习题

#### 选择题

1. 同一根同轴电缆互连主机组成以太网，则主机的通信方式为： `半双工`

    ```
    传统以太网采用广播方式发送消息，同时只有一台主机发送消息，因此是半双工
    
    全双工：可以同时发送和接收消息
    单工：只有一个方向的通信，没有反方向
    ```

    

2. 同轴电缆比双绞线传输速率更快，得益于 `同轴电缆具有更好的屏蔽性，同时有更好的抗噪声性`

3. 卫星通信的好处在于不受气候影响，误码率很低 `错误`

    ```
    卫星通信的缺点：成本高、传输时延长、受气候影响大、保密性差、误码率高
    ```

    

4. 某网络在物理层规定，信号的电平用+10V ~ +15V表示0，用-10V ~ +15V表示1，电线长度在15m以内，体现了物理层接口的 `电气特性`

    ```
    有电压范围的是电气特性
    ```

    



<br>



## 2.3 物理层设备

### 2.3.1 中继器

主要功能是将信号 `整形放大再转发` ，来消除信号的失真和衰减

- `原理` ： 信号再生而非简答放大

- 有两个端口（输入和输出），端口仅作用于 `信号的电气部分` ，不管是否有数据或不适于网段的数据

- 中继器两端 **是网段而不是子网** ，且 **两端的网段必须是同一个协议** 
- 因为工作在物理层， **不能连接两个具有不同速率的局域网**
- `5-4-3规则` ：相互串联的中继器不能超过4个，划分出来的5段中只有中间3段能挂载计算机，外面两段只能用于扩展通信范围的链路断



补充：如果一个设备有存储转发功能，认为可以连接两个不同的的协议，中继器恰好没有存储转发功能



<br>



### 2.3.2 集线器Hub

实质上是一个多端口的中继器

当一个端口收到信号后，经过整形放大再生，紧接着转发到其他所有工作状态的端口（除了输入端口）

- 只在网络中起到信号放大和转发作用，扩大网络的传输范围，而 **不具备信号的定向传送能力**
- 主要使用 双绞线 组建共享网络
- hub直接与交换机相连，将所有结点的通信集中在以其为中心的结点上，但 **逻辑上仍是一个总线网**
- hub的每个端口连接的网络部分是 **同一个网络的不同网段**
- 只能 **半双工**
- **所有端口同属一个冲突域** ，一个带宽为10Mb/s的集线器上有8太计算机，每台计算机上带宽为1.25Mb/s



<br>



### 2.3.3 习题

#### 选择题：

1. 转发器的作用是 `放大信号`

    ```
    转发器是物理层设备，不能识别数据链路层的帧，无寻址功能，只能放大信号
    ```

    

2. 



<br>



# 第三章 数据链路层

## 3.1 数据链路层的功能

在物理层的基础上向网络层提供服务， **将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路**

### 3.1.1 为网络层提供服务

对网络层来说，数据链路层的基本任务 ： 将源机器中来自网络层的数据传输到目标机器的网络层

具体的服务有三种：

- `无确认的无连接服务` 

    丢失的帧不重发，由上层处理

    适合 ： 实时通信或误码率低的通信信道，以太网

- `有确认的无连接服务` 

    目的机器收到帧后必须发回确认

    如果在规定时间内未收到确认，就重传帧

    适合 ： 误码率较高的通信信道，如无线通信

- `有确认的面向连接的服务` 

    分为建立链路、传输帧、释放链路三个阶段

    对每一帧都要确认后才发送下一帧，可靠性最高

    适合 ： 对可靠性、实时性要求高的情况

补充： **只要有连接，就一定有确认**



<br>



### 3.1.2 链路管理

`链路管理` ： 数据链路层连接的建立、维持、释放过程，主要用于 **面向连接的服务**

要通信要先确认对方处于就绪状态



<br>



### 3.1.3 帧定界、帧同步和透明传输

网络层的分组封装成帧后，才能在两台主机之间传输信息

一段数据加上首部和尾部就构成了帧，首部和尾部包含了控制信息

其中就有

- `帧定界` ：确定帧的界限 
- `帧同步` ： 接收方能从比特流中区分出帧的起始和终止（两个结束标志和他们中间的部分就是一个帧）

数据部分占比要尽量大， `最大传送单元MTU` 就是规定的帧的数据部分的长度上限

`透明传输` ：当数据中出现结束标识时，不会误认为传输结束。也就是不管数据有什么，都能传输



<br>



### 3.1.4 流量控制

**流量控制** ： 限制发送方的数据流量，使其不超过接收方的接受能力

根据某种机制，判断什么时候暂停，什么时候继续

对于 `数据链路层（OSI模型）` ， 控制的是 **相邻两结点之间数据链路上的流量**

对于 `运输层(TCP/IP模型)` ，控制的是 **从源端到目的端之间的流量**



<br>



### 3.1.5 差错控制

**差错控制** ： 用来使发送方确定接收方是否正确收到数据

错误分为：

- `位错` ： 帧中某些位出现了差错

    采用 `循环冗余校验CRC` 发现位错

    通过 `自动重传请求ARQ` 来重传出错的帧

    具体 ： 将帧和CRC冗余检错码一并发送，如果发现错误就丢弃，超时重传该帧。也称为 `ARQ法`

    只需返回很少的控制信息就能进行校验

- `帧错`

    帧的丢失、重复、失序等

    引入 `定时器超时重发` 和 `编号机制` 来保证



<br>



### 3.1.6 习题

#### 选择题：

1. 数据链路层协议不包括 ： `为终端结点隐蔽物理传输的细节`

    ```
    这个应该是物理层的功能
    
    数据链路层的功能：
    1. 将比特流组织成帧————帧定界
    2. 控制帧在物理信道上的传输，包括如何处理差错————差错检验
    3. 链路的建立、维护、释放————链路管理
    4. 控制帧的传输速率—————流量控制
    ```

    

2. 对于信道比较可靠且实时性要求高的网络，适合采用 `无确认的无连接服务`

    ```
    题目说了，信道比较可靠因此不确认也可以
    同时实时性要求高的话，有连接回浪费时间
    
    对于实时性要求高的需求来说，数据来的慢比数据损坏还要严重
    ```

    

3. `ICMP` 不是数据链路层的标准

    ```
    国际控制报文协议ICMP是网络层的
    
    错误选项SLIP
    PPP就是在SLIP上发展而来的，因此他们都是数据链路层的
    ```

    

4. 假设物理信道的传输成功率是 95% ，而平均一个网络分组需要10个帧来发送。若数据链路层采用无确认的无连接服务，则发送网络层分组的成功率为 `60%`

    ```
    要全部成功才算成功
    (0.95) ^ 10 , 约等于0.6
    ```

    



<br>



## 3.2 组帧

将比特组合成帧来传输的 **目的**  ： 出错时是需要重传出错的帧不必重传全部数据

**组帧** ： 发送方按一定规则把网络层的分组封装成帧的过程

组帧主要需要解决的问题有 `帧定界` 、 `帧同步` 、 `透明传输` 等

补充 ：

-  组帧要加首部和尾部，因为帧是信息传输的最小单位
- 而分组（IP数据报）只是帧中的数据部分，因此不需要加尾部

下面是4种常用的组帧方法

### 3.2.1 字符计数法

在 `帧头部` 用一个 `计数字段` 来标明帧内字符数（包含计数字段本身的那一字节）

缺点：

- 如果计数字段出错，就失去同步



<br>



### 3.2.2 字符填充的首位界定符法

使用 `特定字符` 来定界一帧的开始和结束

- `SOH` 放在帧首部前面
- `EOT` 放在帧尾部后面
- 为了防止内容误判，加上转义字符 `ESC` ，如果内容中有 `ESC` ，则在 `ESC` 前面加上 `ESC`



<br>



### 3.2.3 零比特填充的首位标志法

允许数据帧包含任意个数的比特，允许每个字符的编码包含任意个数的比特

用 `01111110` (两个0中间有6个1) 来标志帧的开始和结束

比特流中每遇到连续五个1，就自动在后面加一个0。这样就能避免因为内容误认为帧的结束

接收方采用反操作，将数据复原

容易用 `硬件` 实现，性能比字符填充法好



<br>



### 3.2.4 违规编码法

在 `物理层` 进行比特编码时，常采用

例如曼切斯特编码只有 `高-低` 和 `低-高` 电平（来代表1和0）

那么 `高-高` 和 `低-低` 就是违规的，可以用来定界

**局域网 IEEE 802** 就采用了此方法

不需要任何填充技术就能实现透明传输

但只适用于 `采用冗余编码` 的特殊编码环境



<br>



**总结：**

- 字节计数法 ： 脆弱
- 字符填充法 ： 复杂、不兼容
- 常用的组帧方法 ： 比特填充法、违规编码法



<br>



### 3.2.5 习题

#### 应用题

1. 在一个数据链路协议中使用一些字符编码

    ```bash
    A 01000111        B 11100011        ESC 11100000        FLAG 01111110
    ```

    在使用下面成帧方法情况下，说明传送4个字符A、B、ESC、FLAG所组织的帧而实际发送的二进制位序列（FLAG是首位标志 ESC是转义字符）

    1）字符计数法

    2）使用字符填充的首位定界法

    3）使用比特填充的首位标志法



<br>



## 3.3 差错控制

`比特差错` ： 比特在传输过程中，1变0和0变成1，是传输差错中的一种

使用编码技术进行差错控制，主要有两类

- `自动重传ARQ` ： 接收方检测到差错时，就设法通知发送端重传
- `前向纠错FEC`

差错控制又可分为：

- `检错编码`
- `纠错编码`

### 3.3.1 检错编码

检错编码都采用 `冗余编码技术`

在有效数据附加一定的冗余位再发送，接收端根据收到的码字是否符合规范来判断是否出错

#### 奇偶校验码

由n-1位信息元和1为校验组成

- `奇校验码` ： 加上校验元后，长度为n的码字中1的个数为奇数
- `偶校验码` ： 加上校验元后，长度为n的码字中1的个数为偶数

奇偶校验码只能检测 **奇数位** 的数据是否出错

**而且不知道哪儿错了**



<br>



#### 循环冗余码 CRC（先跳过）

也称 **多项式码**



<br>



### 3.3.2 纠错编码

根据冗余信息，推导出正确的应该是什么样的

#### 海明码（先跳过）





<br>



### 3.3.3 习题（先跳过）



<br>



## 3.4 流量控制和可靠传输机制

### 3.4.1 流量控制、可靠传输与滑动窗口机制

流量控制的基本方法是 **接收方控制发送发的速率**

常用的流量控制方法：

**停止-等待**

- 发送一帧，就要等待接收方的应答，然后再发送下一帧
- 效率低

**滑动窗口**

- 发送方维持一组允许发送的帧的序号 —— `发送窗口` ， `发送窗口大小WT`表示在未收到确认情况下还能发送多少个数据帧
- 接收方维持一组允许接收的帧的序号 —— `接收窗口`
- 发送端收到确认帧，就往后滑动一个帧的位置，当窗口内都是已发送等确认的帧时，停止
- 接收端收到数据帧后，将窗口向后滑动一个帧的位置，并发回确认帧，收到窗口外的帧都丢弃
- 接收窗口为1时，能保证有序接收帧
- 数据链路层的滑动窗口，传输过程中 **窗口大小固定** （和传输层的滑动窗口不同）



<br>



从滑动窗口的角度看：

- 停止-等待协议 ：发送窗口=1，接收窗口=1 
- 后退N帧协议 ： 发送窗口>1，接收窗口=1
- 选择重传协议 ： 发送窗口>1，接收窗口>1



<br>



**可靠传输机制**

数据链路层可靠性的实现：

- `确认` ： 无数据的控制帧，有些情况是 `捎带确认`
- `超时重传` ： 计时器

自动重传请求ARQ ： 接收方请求发送方重传出错的数据帧来恢复出错的帧，请求分为三种：

- `停止-等待协议`
- `后退N帧协议`
- `选择性重传协议`

其中后两种在窗口足够的时候可以连续流动，也称为 `连续ARQ` ，是滑动窗口和超时重传技术的结合

数据链路层中 `流量控制机制` 和 `可靠传输机制` 交织在一起





<br>



### 3.4.2 停止-等待协议

发送方发送1帧后必须等待确认

从滑动窗口的角度来看，停止-等待协议相当于 **发送窗口和接收窗口都是1的滑动窗口协议**

除了帧丢失外，还有可能有 两种差错

1. 帧被破坏

    利用差错检测技术检测出后，丢弃，等待超时重传

    直到正确达到为止

2. 帧正确但确认帧被破坏

    发送方收不到确认帧，会一直重传

    接收方收到同样的帧会丢弃，并重传确认帧（交替用 `ACK0` 和 `ACK1` 来表示）

    - 当出现相同序号的帧，说明进行了超时重传
    - 当出现了序号相同的确认帧，说明收到了重复帧

    双方设置一个帧缓冲区，发送方发送的同时保留一个副本用于重传，收到确认帧时才将副本删除

    **停止-等待协议信道利用率低**



<br>



### 3.4.3 后退N帧协议GBN

发送方可以连续发送帧， **接收方只允许按顺序接受帧**

从滑动窗口的角度来看，GBN协议相当于 **发送窗口大于1且接收窗是1的滑动窗口协议**

- 发送窗口大于等于1且小于2^n - 1
- 接收窗口1保证了有序接收

当发送方发了N个帧后，发现第1个帧在计时器超时后仍未返回确认帧，此时发送方需要重传该帧和该帧后的N-1个帧

每发送一个帧就设置一个计时器

且接收方可以 **在收到多个正确帧后只对最后一个帧做确认**

只要有帧出错，他后面的（哪怕是正确的）帧都要进行重传

当误码率较大时，GBN不一定优于停止-等待





<br>



### 3.4.4 选择重传协议SR

设法只重传出错的帧或者计时器超时的帧， **避免重传正确的帧** ，因此需要一个缓冲区，数量等于窗口大小

**加大接收窗口** ， 先收下序号不连续但是在窗口中的帧，

等所缺序号的帧收到后在一并送交主机

从滑动窗口的角度来看，SR协议相当于 **发送窗口和接收窗口都大于1的滑动窗口协议**

**每个发送缓冲区对应一个计时器** ， 计时器超时，将缓冲区的帧重传

此外，还有比上面两个 **更有效的差错处理策略** ：一旦怀疑帧出错，就发送一个 `否定帧NAK` 给发送方，要求对NAK中指定的帧进行重传

**发送窗口和接受窗口的大小相等，且最大值都是序号范围的一半**

**注意：SR协议的确认帧没有累积确认作用！！！**



<br>



#### 信道计算相关（重点）

`信道利用率` ： 发送方在一个发送周期的时间内，有效发送数据时间占整个发送周期的比率

`发送周期T` ： 开始发到收到第一个确认帧为止

```
发送方发送了L比特的数据 数据传输率为C （L也就是帧长）
则发送方用于发送有效数据的时间是L / C
发送周期T = L / C + 2 * 单向延时R

信道利用率为(L / C) / T
信道吞吐率 = 信道利用率 * 发送速率
```



<br>



### 3.4.5 习题

#### 选择题

1. 一个信道的数据传输率为 4kb/s ，单向传播时延为 30ms ，如果使用停止-等待协议的信道最大利用率达到百分之80，那么要求的数据帧长度至少为 `960bit`

    ```
    设C为数据传输速率 L为帧长 R为单程传播时延
    停止-等待协议的信道最大利用率为
    (L / C) / (L / C + 2R) = 0.8
    求出L = 960bit
    ```

    

2. 数据链路层采用后退N帧协议来进行流量控制和差错控制，发送方已经发送了编号为0~6的帧，计时器超时时，只收到了1、3、5帧的确认，发送方需要重传的帧的数目是 `1`

    ```
    GBN采用累积确认
    当收到第5帧的确认说明了0~5帧，只需要重传编号为6的帧
    ```

    

3. 数据链路层采用GBN协议，如果发送窗口的大小是32，那么至少需要 `6` 位的序列号才能保证协议不出错

    ```
    GBN协议中，序列号个数不小于MAX_SEQ + 1
    发送窗口大小是32，那么序列号个数最少应该是33
    因此需要6位序列号
    ```

    

4. 对于窗口大小为n的滑动窗口，最多可以有 `n-1` 帧已发送但没确认

5. 【2020】假设甲采用停止-等待协议向乙发送数据帧，数据帧和确认帧长均为 1000B ，数据传输速率是 10kb/s，单向传播延时为 200ms ，则甲的最大信道利用率为 `40%`

    ```
    发送数据帧或确认帧的时间： t = 1000 * 8b / 10kb/s = 800ms
    发送周期： T = 800ms + 200ms + 800ms + 200ms = 2000ms
    信道利用率：t / T = 800 / 2000 = 40%
    ```

    

6. 【2019】对于滑动窗口协议，若分组序号采用3比特编号，发送窗口大小为5，则接收窗口最大是 `3`

    ```
    停止-等待和后退N帧协议的接收窗口大小都是1，要接收窗口最大，得是选择重传协议
    
    在选择重传协议中，需要满足：
    1. 发送窗口大小 + 接收窗口大小 < 2^n
    2. 且接收窗口不应该超过发送窗口
    
    因此接收窗口大小不应该超过序号范围的一半 <= 2^(n-1)
    带入此时n = 3
    根据上面的1
    5 + x < 2^3
    得到x最大值为3
    ```

    

7. 【2018】甲采用停止-等待协议向乙发送数据，数据传输速率是 3kb/s ，单向传输时延是 200ms ，忽略确认帧的传播时延。当信道利用率等于 40% 时，数据帧长度为 `800bit`

8. 【2015】甲采用滑动窗口协议向乙发送数据，数据传输速率是 128kb/s ，单向传输时延是 250ms ，帧长1000字节。不考虑确认帧的开销，为使链路利用率不小于 80% ，帧序号的比特数至少是 `4`

    ```
    发送周期T = 第一个帧传播时间 + 确认帧的传播时间 + 2段传播时延（题目忽略确认帧，因此少了一段确认帧和一段传播时延）
    T = 1000B / 128kb/s + RTT = 0.5625s
    设帧长L
    （L / 128kb/s） /  T >= 0.8 
    得到L >= 7200B
    也就是一个周期至少发7.2个帧
    设需要的比特数（也就是位数）为n
    则2^n - 1 >= 7.2
    因此n至少为4
    ```

    

9. 【2011】数据链路层采用选择重传协议传输数据，发送方发送0~3号数据帧，已经收到1号帧的确认，而0和2号帧依次超时，此时需要重传的帧数是 `2`

    ```
    SR协议中，接收方逐个确认正确接收的分组，不管接收到的分组是否有序，只要正确接收就发送选择ACK分组进行确认，因此ACK分组不再具有累积确认的作用
    因此需要重传0和2号帧
    ```

    

10. 【2012】两台主机之间数据链路层采用后退N帧协议传输数据，数据传输速率为 16kb/s ，单向传播时延为 270ms ，数据帧的长度范围是128~512字节，接收方总是以与数据帧等长的帧进行确认。为使信道利用率最高，帧序号的比特数至少为 `4`

    ```
    为了使信道利用率最高，采用最短的帧长来计算
    
    发送一帧的时间： 128 * 8 / （16 * 10^3） = 64ms
    发送一帧到收到确认的时间： 64 + 270 * 2 + 64 = 668ms
    这段时间可以发送：668 / 64 = 10.4帧
    发送这么多帧需要4位比特来编号
    ```

    

11. 【2014】主机甲和乙之间使用后退N帧协议传输数据，甲的发送窗口尺寸为1000，数据帧长为1000字节，信道带宽为 100Mb/s ，乙每收到一个数据帧立即用一个短帧（忽略其传输延迟）进行确认，若甲、乙之间的单向传输时延是 50ms ，则甲可以达到的最大平均数据传输率为 `80Mb/s`

     ```
     考虑制约甲数据传输速率的因素，有两个，他们中的最小值就是答案
     1. 传输速率一定不超过信道带宽
     2. 甲、乙主机采用后退N帧协议，考虑发送一个数据到接收到确认之前，最多能发送多少数据
     
     甲的窗口大小是1000，也就是收到第一个数据的确认帧之前，最多能发送1000个数据帧，也就是发送1000 * 1000B = 1MB的内容
     而发送第一个帧到收到它的确认帧的时间： 1000B/100Mb/s + 2 * 50ms = 0.10008s
     此时最大数据传输速率：1MB / 0.10008s = 10MB/s = 80Mb/s
     
     而信道带宽是100Mb/s
     答案就是min(80, 100) = 80Mb/s
     ```

     



<br>



## 3.5 介质访问控制

介质访问控制就是 **防止信道上两对结点的通信受到其他通信的干扰**

决定信道中信道分配的协议属于数据链路层中的 `介质访问控制（MAC）子层`

常见的介质访问控制方法：

- `信道划分`
- `随机访问`
- `轮训访问`

### 3.5.1 信道划分介质访问控制

将设备和其他设备的通信分隔开来，把时域或频域资源合理分配

`多路复用技术` ：把多个信号组合在一条物理信道上传输，使得多个设备共享信道（在逻辑上划分互不干扰的子信道），提高信道的利用率

#### 频分多路复用FDM

将物理信道带宽分割成若干子信道，每个字信道传输一种信号

子信道的总和不超过总带宽

且为了防止子信道干扰，还加入保护频带

优点：

- 充分利用带宽
- 系统效率较高



<br>



#### 时分多路复用TDM

按时间分时间片，轮流给多个信号用

统计时分多路复用（异步时分多路复用）STDM是TDM的改进，采用STDM帧，按需动态分配时隙，提高线路利用率



<br>



#### 波分多路复用WDM

根据光的波长不同，各路光信号互不干扰



<br>



#### 码分多路复用CDM

采用不同的编码来区分不同路的信号

同一个车上既运黄豆也运绿豆，到了再分开

既共享信道的频率，又共享时间

其中用的更多的是 `码分多址CDMA`

将每个比特时间分成码片

优点：

- 频谱利用率低
- 抗干扰能力强
- 主要用于无线通信





<br>



### 3.5.2 随机访问介质访问控制

随机访问协议中，不集中控制次序，用户能根据自己意愿发送信息，占用整个信道，也称 `争用型协议`

```
争取信道发送权，胜利者独占信道
```

总线型网络中，多个用户同时发送信息时会造成帧的冲突

为了解决碰撞，每个用户按照一定规则（也就是随机访问介质控制协议）重传他的帧来，直到无碰撞通过

#### ALOHA 协议

```
不进行任何检测就发数据，如果一段时间没收到确认，等待一段时间再法，直到成功
```

也可以进一步分为

- 纯ALOHA协议
- 时隙ALOHA协议



<br>



#### CSMA 协议



<br>



#### CSMA/CD 协议



<br>



#### CSMA/CA 协议



<br>



### 3.5.3 轮询访问



<br>



### 3.5.4 习题



<br>





## 3.6 局域网

### 3.6.1 局域网基本概念和体系结构



<br>



###  3.6.2 以太网与 IEEE 802.3



<br>



### 3.6.3 IEEE 802.11 无线局域网



<br>



### 3.6.4 VLAN基本概念和基本原理



<br>



### 3.6.5 习题



<br>



